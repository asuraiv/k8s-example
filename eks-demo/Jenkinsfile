node {
    parameters {
        string(name: 'TAG', defaultValue: 'latest', description: '')
    }
    stage('Deploy to K8S Cluster') {
        withKubeConfig([credentialsId: 'demo-cluster-kubeconfig', serverUrl: 'https://EBF542A5733BBE7F5CB8317EAF1ABBE3.yl4.ap-northeast-2.eks.amazonaws.com']) {
            sh 'kubectl create cm demo-config --from-literal=tag=${TAG} -o yaml --dry-run=client | kubectl replace -f -'
            sh 'kubectl apply -f ./eks-demo/demo-deployment.yaml --record'
            sh 'kubectl rollout status deployment eks-demo'
        }
    }
}